/*

@mygithub: https://github.com/fredwei

@mysite: www.fredwei.com

@version v1.0.0

@License MIT

*/
!function(n,t){function e(n,t){function e(n){++o,a.push({mid:o,w:n.width,h:n.height}),o===r?t(a):i()}function i(){var t=new Image;t.src=n[o],t.complete?e(t):t.onerror=t.onload=function(){e(t)}}var o=0,r=n.length,a=[];i()}function i(){var e;t(n).on("resize",function(){clearTimeout(e),e=setTimeout(function(){l.reload()},100)})}function o(n){var t=n[0];for(var e in n)n[e]>t&&(t=n[e]);return t}function r(n){var t=n[0],e=0;for(var i in n)n[i]<t&&(t=n[i],e=i);return e}function a(n){for(var t in n)n[t]=Math.round(n[t]);return n}function c(){var n=0,t=parseFloat(u.between),e=[],i=[],c={row:0,col:0};"string"==typeof u.between&&u.between.indexOf("%")&&(t=t/100*u.boxWidth),u.betweenVal=t;var l=(u.boxWidth-u.betweenVal*(u.columns-1))/u.columns;for(n=0;n<u.columns;n++)n+1===u.columns?e.push(u.boxWidth-l):0===n?e.push(0):e.push((l+u.betweenVal)*n),i.push(0);var f,m,s=0;for(n=0;n<u.itemLen;n++)f=u.$item.eq(n),c.col=r(i),s=l*u.imgArr[n].h/u.imgArr[n].w,m=a({top:i[c.row],left:e[c.col],width:l,height:s,opacity:u.opacity}),f.css(m),i[c.row]+=s+u.betweenVal,c.row=r(i);u.$box.css("height",o(i)),"function"==typeof u.initcallback&&u.initcallback(u.$box)}var l={},u={box:".waterfall",item:".waterfall_item",itemimg:"img",columns:3,between:"1%",isResize:!0,opacity:1,initcallback:function(n){}};l.imgload=function(n,i){var o=t(n),r=[];o.find(u.itemimg).each(function(){r.push(t(this).attr("src"))}),e(r,i)},l.reload=function(){l.imgload(u.box,function(n){u.$box=t(u.box),u.boxWidth=u.$box.width(),u.$item=t(u.item),u.itemLen=u.$item.length,u.imgArr=n,c()})},l.set=function(n){var e=["columns","between"],i=!1;for(var o in n)t.inArray(o,e)>-1&&(i=!0,u[o]=n[o]);i&&l.reload()},l.init=function(n){u=t.extend(u,n),u.isResize&&i(),l.reload()},n.waterfall=l}(window,$);